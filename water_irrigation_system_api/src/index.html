<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Control the system</title>
    <style>
        .status {
            padding: 10px;
            border: 1px solid #ccc;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
<h2>Control the system</h2>

<p><strong>Pump Status:</strong> <span id="pump-status">Unknown</span></p>
<button onclick="pumpOnBtnCLickHandler()">Pump ON</button>
<button onclick="pumpOffBtnCLickHandler()">Pump OFF</button>

<h3>Valves Status</h3>
<div class="status">
    <p><strong>Valve 1:</strong> <span id="valve1-status">Unknown</span></p>
    <p><strong>Valve 2:</strong> <span id="valve2-status">Unknown</span></p>
    <p><strong>Valve 3:</strong> <span id="valve3-status">Unknown</span></p>
</div>

<h3>Sensor Data</h3>
<div class="status">
    <p><strong>Soil Moisture Sensor 1:</strong> <span id="soilMoisture1">Unknown</span></p>
    <p><strong>Soil Moisture Sensor 2:</strong> <span id="soilMoisture2">Unknown</span></p>
    <p><strong>Temperature Sensor:</strong> <span id="temperature">Unknown</span></p>
    <p><strong>Water Level Sensor:</strong> <span id="waterLevel">Unknown</span></p>
    <p><strong>Air Humidity Sensor:</strong> <span id="airHumidity">Unknown</span></p>
</div>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js" integrity="sha384-2huaZvOR9iDzHqslqwpR87isEmrfxqyWOF7hr7BY6KG0+hVKLoEXMPUJw3ynWuhO" crossorigin="anonymous"></script>
<script>
    const socket = io();

    // Listen for connection event
    socket.on("connect", () => {
        console.log("Connected to the server!");
        socket.emit("client", true);
    });

        // Listen for the current state
        socket.on('sendCurrentState', (data) => {
            console.log('Received initial system data:', data);
            updateUI(data);  // Update the UI when the data is first received
        });

        // Listen for updates to the system's state
        socket.on('updateCurrentStateOnClientSide', (set) => {
            console.log('Received updated system data:', set);
            updateUI(set);  // Update the UI when the system state is updated
        });


    // Function to emit pump ON action
    function pumpOnBtnCLickHandler() {
        console.log('Pump ON button clicked');
        socket.emit('pump', 'on');
    }

    // Function to emit pump OFF action
    function pumpOffBtnCLickHandler() {
        console.log('Pump OFF button clicked');
        socket.emit('pump', 'off');
    }

    // Function to update the UI with the current state of the system
    function updateUI(data) {
        // Update pump status
        document.getElementById('pump-status').textContent = data.pump ? 'ON' : 'OFF';

        // Update valves status
        document.getElementById('valve1-status').textContent = data.valve1 ? 'Open' : 'Closed';
        document.getElementById('valve2-status').textContent = data.valve2 ? 'Open' : 'Closed';
        document.getElementById('valve3-status').textContent = data.valve3 ? 'Open' : 'Closed';

        // Update sensor values
        document.getElementById('soilMoisture1').textContent = `${data.soilMoistureSensor1.value} ${data.soilMoistureSensor1.unit}`;
        document.getElementById('soilMoisture2').textContent = `${data.soilMoistureSensor2.value} ${data.soilMoistureSensor2.unit}`;
        document.getElementById('temperature').textContent = `${data.temperatureSensor.value} ${data.temperatureSensor.unit}`;
        document.getElementById('waterLevel').textContent = `${data.waterLevelSensor.value} ${data.waterLevelSensor.unit}`;
        document.getElementById('airHumidity').textContent = `${data.airHumiditySensor.value} ${data.airHumiditySensor.unit}`;
    }
</script>
</body>
</html>
